## Что такое venv и зачем оно нужно

venv — это встроенный в Python модуль, который позволяет создавать виртуальное окружение для работы над конкретным проектом. Это изолированная среда, содержащая все необходимые зависимости для работы программного обеспечения.   
dzen.ru
serverspace.ru
blog.skillfactory.ru

Зачем нужно venv:
- Изоляция зависимостей — каждый проект может использовать собственные версии библиотек (например, requests для HTTP-запросов, Django для веб-разработки).   
dzen.ru
blog.tutortop.ru

- Предотвращение конфликтов — любые установки или обновления пакетов в одном проекте не затрагивают другой.  
timeweb.cloud

- Упрощение развёртывания — можно легко воссоздать точное окружение на другом компьютере или сервере. 
timeweb.cloud

- Обучение и экспериментирование — виртуальные окружения служат безопасной площадкой для изучения новых библиотек и версий Python.   


### Принцип работы

venv — это автономный каталог, который содержит:   

- собственную копию интерпретатора Python (или ссылку на него);
- независимый менеджер пакетов pip;
- все библиотеки и зависимости, которые устанавливаются исключительно для этого проекта.  


Когда окружение «активировано», система начинает использовать именно этот локальный набор инструментов, а не глобальный, установленный в операционной системе.   

### Создание

Модуль venv включён в стандартную поставку Python, начиная с версии 3.3. Чтобы создать виртуальное окружение, нужно:   

- Перейти в директорию проекта или создать новую.
- Выполнить команду: 

      python3 -m venv venv 
      # или
      python -m venv venv
    
Здесь второй `venv` — имя директории, в которой будет находиться виртуальное окружение. Можно назвать её по-другому (например, `env` или `.venv`), но часто используется именно `venv` по соглашению.  


После выполнения команды будет создана структура папок, содержащая собственный интерпретатор Python и каталог для библиотек.  


Видео с инструкцией по созданию виртуального окружения (venv) в Python:  
24:57  
Создаем виртуальное окружение venv для Python - Future People — Видео от mmx_2024_informatika  
https://yandex.ru/video/preview/5148915309943054661?path=yandex_neuro 

### Использование

После создания виртуального окружения его нужно активировать: sky.pro  
- В Linux и macOS — команда: `source venv/bin/activate`.
- В Windows — в CMD: 

      venv\Scripts\activate.bat


serverspace.ru
blog.skillfactory.ru

После активации в терминале появится префикс с именем окружения. Теперь любые установленные библиотеки будут сохраняться только внутри этого окружения.   
serverspace.ru

Чтобы выйти из виртуального окружения и вернуться к системному Python, нужно выполнить команду: `deactivate`. Если окружение больше не нужно, просто удалить его директорию: 

    rm -rf venv  

serverspace.ru

### Дополнительно

https://skillbox.ru/media/code/python-venv-chto-takoe-virtualnoe-okruzhenie-i-kak-im-polzovatsya

#### Количество окружений

Активировать можно только одно окружение venv за раз.  

#### CMD vs PowerShell

Мы столкнулись с проблемой активации виртуального окружения через команду терминала из-за политики выполнения PowerShell. Это распространённая ситуация в Windows.

#### Местоположение окружения

Проверим местоположение нашего виртуального окружения:

    pip -V

Результат команды показывает, что мы используем PIP в виртуальном окружении venv. Это подтверждает, что мы работаем в нужном окружении. Также в выводе указана версия Python.

#### Сохранить окружение для переноса

https://serverspace.ru/articles/kak-sozdat-i-ispolzovat-venv/

Чтобы сохранить список библиотек в файл, используйте:

    pip freeze > requirements.txt 

А затем — восстановить на другой машине:

    pip install -r requirements.txt 

#### Узнать, где установлен Python в Windows

    where python

Пропишет пути, в том числе путь временного окружения. После деактивации путь окружения будет исключён.  

---

## venv and .gitignore

Папку venv (каталог виртуальной среды) в проекте на Python рекомендуется добавить в файл .gitignore (для системы контроля версий, например, Git). Это позволяет избегать добавления папки в репозиторий.   
iditect.comgitscripts.com

Это важно по нескольким причинам:

* **Предотвращение репликации** — виртуальная среда содержит установленные пакеты, которые можно установить снова с помощью файла 

  requirements.txt

  . Добавление папки в репозиторий может привести к ненужной репликации пакетов, что увеличит размер репозитория.
* **Независимость от платформы** — виртуальные среды могут быть специфичны для платформы, и включение их в репозиторий может вызвать проблемы совместимости при обмене кодом между разными средами.
* **Изоляция** — виртуальные среды предназначены для изолированной среды проекта, и игнорирование папки venv гарантирует, что другие пользователи кода могут создавать свою виртуальную среду на основе файла 

  requirements.txt

   без вмешательства.

 iditect.com

**Рекомендации**

* **Создать файл .gitignore** в корне проекта. Можно сделать это вручную или с помощью команды 

  touch

  .
* **Добавить папку venv в файл** — открыть файл в текстовом редакторе и вставить строку: 

  venv/

  . Это указывает Git игнорировать именно папку venv (со всеми файлами - Дм.С.), а не все файлы внутри неё.  

* **Проверить, правильно ли папка игнорируется** — можно запустить команду 

  git status

  . Если всё настроено правильно, папка venv не будет указана среди не отслеживаемых файлов.

 gitscripts.com

**Пример**

Пример содержимого файла .gitignore для проекта с игнорированием папки venv:

    # Python-generated files  
    __pycache__/  
    *.py[oc]  
    build/  
    wheels/  
    *.egg-info  
    # Project files  
    .venv  

В этом примере 

.venv

 игнорирует директорию виртуального окружения. 

### Кратко

Лучше игнорировать.  
`.gitignore`:

    venv/

Это указание Git игнорировать каталог `venv` с завершающей косой чертой, которая обозначает, что это каталог, и гарантирует, что все файлы в нём будут проигнорированы.

https://gitscripts.com/git-ignore-venv

## Git vs Venv

Создание новой ветки `develop` сделало каталог `venv` нечитаемым для окружения. И хоть он и включался и был префикс (venv) в командной строке, всё поведение указывало, что python не видит venv:
- Команда `pip freeze > requirements.txt` создавала перечень из глобальной области. Команда должна была создать пустой файл для данного пустого проекта.   
- Команды `pip -V` и `where python` указывали только на глобальную область. Команда должна была увидеть pip и python внутри папки проекта.    


Решение, которое было принято:  

я удалил папку venv, не меняя ветку `develop`, и установил venv заново. Уже установленные глобально пакеты - оставил глобальными. После активации `venv`, pip и python правильно указывают на локальную папку.   

## файл python не видит пакет, установленный глобально

**Ошибка «Файл Python не видит пакет, установленный глобально»** (например, ImportError: No module named <имя_пакета>) возникает, когда интерпретатор Python не находит установленный пакет в путях поиска. Это может быть связано с неправильной установкой pip или настройками окружения. realpython.comgitverse.ru

**Причины**

* **Неправильная версия pip**. Каждая установка Python обычно включает свой исполняемый файл pip, и по умолчанию пакеты устанавливаются в месте, где может найти их только эта версия. Если запущен неправильный pip, пакеты не будут видны интерпретатору Python.
* **Некорректные настройки окружения**. Например, директория, содержащая пакет, не присутствует в списке путей поиска Python (переменная sys.path).
* **Использование виртуальных окружений**. Если работать в таком окружении, установленные в нём модули не будут доступны за его пределами.

 realpython.comgitverse.ru

**Решение**

* **Проверить пути поиска Python**. Проверить содержимое sys.path можно внутри Python-скрипта: 

  import sys; print(sys.path)

   — это выведет список путей. Нужно убедиться, что директория, содержащая пакет, присутствует в этом списке.

* **Использовать правильную версию pip**. Например, запустить pip с помощью команды 

  python -m pip

   — это использует исполняемый файл pip, связанный с нужной версией Python.

* **Активировать виртуальное окружение**. Если работать в таком окружении, перед запуском скрипта нужно убедиться, что оно активировано. Иначе pip будет устанавливать пакеты в глобальное окружение, которое может быть недоступно для скрипта.

* **Настроить переменную окружения PYTHONPATH** (если нужно добавить дополнительные директории в список путей поиска Python). Однако изменение PYTHONPATH следует применять с осторожностью, так как некорректная настройка может привести к другим проблемам.

 gitverse.rurealpython.com

Если проблема не решается, рекомендуется обратиться к документации pip или сообществу Python. gitverse.ru

## Venv и Новая папка

> При копировании в новое место и переименовании папки, где бот работает правильно, venv при активации ссылается не на новую папку, а на старую. 

## Кратко

    # Перемещение на другой диск
    cd /d E:/

    # установка (единожды) в текущую папку
    # где второй venv - задаваемое имя папки для окружения
    python3 -m venv venv
    # или
    python -m venv venv
    
    # активация
    venv\Scripts\activate.bat

    # информация
    pip -V
    where python

    # сохранить список пакетов, -
    # локальных, если включен venv, и глобальных, если venv не включен
    pip freeze > requirements.txt 

    # если нужно восстановить список пакетов на другой машине
    pip install -r requirements.txt 

    # только посмотреть список пакетов
    pip freeze

    # деактивация
    deactivate
    venv\Scripts\deactivate.bat

    # Если нужно удалить окружение venv в windows - просто удалить папку или
    rmdir /s /q venv

    # Если используется long polling Telegram,
    # запуск бота:  
    python main.py

    # Остановка бота:  
    Ctrl+C

    # .gitignore:
    venv/

