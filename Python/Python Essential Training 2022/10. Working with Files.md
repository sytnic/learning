## 057-Opening reading and writing

Reading Files

```py
f = open('10_01_file.txt', 'r')
print(f)

# Выводит объект файла

# <_io.TextIOWrapper name='10_01_file.txt' mode='r' encoding='UTF-8'>
```

```py
f.readline()

# Читает по каждой следующей строке при вызове.

# 'Simple is better than complex.\n'
```

```py
f.readlines()

# Получает все строки файла.

# ['Complex is better than complicated.\n',
# 'Flat is better than nested.\n',
# ...
# 'If the implementation is easy to explain, it may be a good idea.\n',
# "Namespaces are one honking great idea -- let's do more of those!"]

```

```py
f = open('10_01_file.txt', 'r')
for line in f.readlines():
    print(line.strip())

# strip() убирает пустую строку, возникающую из-за \n в конце каждой строки

# Beautiful is better than ugly.
# Explicit is better than implicit.
# ...
# If the implementation is easy to explain, it may be a good idea.
# Namespaces are one honking great idea -- let's do more of those!

```

Writing Files

В режиме 'w' запись в файл производится всегда заново, старые данные удаляются.  

```py
# создаст пустой файл '10_01_output.txt' 
f = open('10_01_output.txt', 'w')
print(f)

# <_io.TextIOWrapper name='10_01_output.txt' mode='w' encoding='UTF-8'>
```

```py
f.write('Line 1\n')
f.write('Line 2\n')

# 7
```

Запись в файл производится только после закрытия файла.

```py
f.close()

```

Appending Files

В режиме 'a' запись в файл производится в дополнение к существующим данным, старые данные не удаляются.  

```py
f = open('10_01_output.txt', 'a')
f.write('Line 3\n')
f.write('Line 4\n')
f.close()


with open('10_01_output.txt', 'a') as f:
    f.write('some stuff\n')
    f.write('some other stuff\n')
    
print(f)

# <_io.TextIOWrapper name='10_01_output.txt' mode='a' encoding='UTF-8'>

```

Файл уже закрыт для записи.

```py
f.write('PS. I forgot some stuff')

# ValueError: I/O operation on closed file.
```

## 058-CSV

### Reading

Пакет CSV устанавливается вместе с Python.

```py
import csv

with open('10_02_us.csv', 'r') as f:
    # получение данных файла, разделителем является tab (\t)
    reader = csv.reader(f, delimiter='\t')
    for row in reader:
        print(row)

# ['country', 'postal code', 'place name', 'state', 'state code', 'county', 'county code', 'latitude', 'longitude', 'accuracy']
# ['US', '99553', 'Akutan', 'Alaska', 'AK', 'Aleutians East', '013', '54.143', '-165.7854', '1']
# ...

```

```py
with open('10_02_us.csv', 'r') as f:
    reader = csv.reader(f, delimiter='\t')
    # пропустить строку заголовков
    next(reader)
    # пропустить следующую строку
    next(reader)
    for row in reader:
        print(row)

# ['US', '99571', 'Cold Bay', 'Alaska', 'AK', 'Aleutians East', '013', '55.1858', '-162.7211', '1']
# ['US', '99583', 'False Pass', 'Alaska', 'AK', 'Aleutians East', '013', '54.8542', '-163.4113', '1']
# ...
```

```py
with open('10_02_us.csv', 'r') as f:
    # преобразовать данные файла в список
    reader = list(csv.reader(f, delimiter='\t'))
    # вывести всё и пропустить первую строку заголовков
    for row in reader[1:]:
        print(row)

# ['US', '99553', 'Akutan', 'Alaska', 'AK', 'Aleutians East', '013', '54.143', '-165.7854', '1']
# ['US', '99571', 'Cold Bay', 'Alaska', 'AK', 'Aleutians East', '013', '55.1858', '-162.7211', '1']

```

```py
with open('10_02_us.csv', 'r') as f:
    # выводить заголовки в каждой строке как ключи
    reader = csv.DictReader(f, delimiter='\t')
    for row in reader:
        print(row)

# {'country': 'US', 'postal code': '99553', 'place name': 'Akutan', 'state': 'Alaska', 'state code': 'AK', 'county': 'Aleutians East', 'county code': '013', 'latitude': '54.143', 'longitude': '-165.7854', 'accuracy': '1'}
# {'country': 'US', 'postal code': '99571', 'place name': 'Cold Bay', 'state': 'Alaska', 'state code': 'AK', 'county': 'Aleutians East', 'county code': '013', 'latitude': '55.1858', 'longitude': '-162.7211', 'accuracy': '1'}
# ...

```

### Filtering data

```py
# получение данных в список и в переменную
with open('10_02_us.csv', 'r') as f:
    data = list(csv.DictReader(f, delimiter='\t'))
```

```py
# поиск простых чисел (не делится на 5)
primes = []
for number in range(2, 99999):
    for factor in range(2, int(number**0.5) + 1):
        if number % factor == 0:
            break
    else:
        primes.append(number)
```

```py

data = [row for row in data if int(row['postal code']) in primes and row['state code'] == 'MA']
len(data)

# 91
# таких 91 почтовых адреса в Массачусетсе
```

### Writing

```py
# запись в новый файл двух столбцов из 91 полученной строки
with open('10_02_ma_prime.csv', 'w') as f:
    writer = csv.writer(f)
    for row in data:
        writer.writerow([row['place name'], row['county']])

```

## 059-JSON

```py
import json
from json import JSONDecodeError, JSONEncoder
```

### Loading JSON

```py
# строка JSON
jsonString = '{"a": "apple", "b": "bear", "c": "cat",}'

try:
    # превращает строку JSON в словарь (dictionary) Python
    json.loads(jsonString)
except JSONDecodeError:
    print('Could not parse JSON!')

# Could not parse JSON!
```

```py
{'a': 'apple', 'b': 'bear', 'c': 'cat',}

# Это словарь Python, он без в кавычек
# {'a': 'apple', 'b': 'bear', 'c': 'cat',}
```

### Dumping JSON

```py
# Обратное преобразование -  
# словарь (dictionary) Python в строку JSON

# словарь (dictionary) Python
pythonDict = {'a': 'apple', 'b': 'bear', 'c': 'cat',}
# преобразование в строку JSON
json.dumps(pythonDict)

# Это строка JSON, она в кавычках
# '{"a": "apple", "b": "bear", "c": "cat"}'
```

### Custom JSON Decoders

Перехват ошибки, если при преобразовании из словаря Python в строку JSON обнаруживается ошибка.

```py
class Animal:
    def __init__(self, name):
        self.name = name

class AnimalEncoder(JSONEncoder):
    def default(self, o):
        if type(o) == Animal:
            return o.name
        return super().default(o)
    
pythonDict = {'a': Animal('aardvark'), 'b': Animal('bear'), 'c': Animal('cat'),}
json.dumps(pythonDict, cls=AnimalEncoder)

# '{"a": "aardvark", "b": "bear", "c": "cat"}'
```

---

```py

```

```py

```

```py

```

