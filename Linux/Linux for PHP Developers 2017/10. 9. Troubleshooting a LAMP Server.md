## 49. Troubleshooting SSH

https://help.ubuntu.com/community/SSH

Решения проблем:
- убедиться, что SSH port проброшен (forwarded) в виртуальной машине
- восстановить забытый пароль  
https://help.ubuntu.com/community/LostPassword
- запущена ли служба SSH.  
  Команда ps - process status.  
  a - другие пользовательские процессы  
  u - имена пользователей процессов  
  x - процессы без управляющего терминала  
  grep - фильтрация  

      ps aux | grep sshd

  Служба ssh - это /usr/sbin/sshd -D

- включить/выключить службу SSH

      sudo service ssh restart

- установить ssh

      sudo apt-get install openssh-server 

- подключиться к SSH изнутри сервера. Внешний вид при входе не изменится, но это будет работа внутри машины. Поэтому потребуется logout, чтобы выйти оттуда в основную машину. Внешний вид опять будет тот же.    

      ssh localhost
      logout

- проверить логи авторизации и sudo для SSH по адресу `/var/log/auth.log`  

      grep sshd /var/log/auth.log | less
      q (выход)

- проверить, добавлены ли домены в файл hosts

      cat /etc/hosts

- подключиться к SSH по терминалу

      ssh -p2222 myusername@localhost 
      logout

- проверить Putty Config или .ssh config

## 50. Troubleshooting Apache

Решение проблем:

- переадресован ли порт в VM
- проверить включен ли apache
- проверить, какие сайты включены в `/etc/apache2/sites-enabled`
- проверить, нет ли опечаток в файлах конфигураций в `/etc/apache2/sites-available/` (иногда достаточно перезагрузки апачи)
- проверить логи в `/var/log/apache2`

Наблюдать онлайн в режиме реального времени за файлом лога

    tail -f vboxsf-access.log

В браузере обратиться к любому установленному сайту

    sandbox.dev:8080/wordpress/

Чтобы остановить слежку, нажмите `Ctrl + C`.

- проверить статус апачи, должны отображаться процессы apache

      ps aux | grep apache2

- проверить сеть командой `netstat`
  - n - numeric ports 
  - a - all sockets
  - p - PID and program

        sudo netstat -nap | grep apache

## 51. Troubleshooting MySQL

Решение проблем:

- переадресован ли порт в VM
- проверить, запущена ли служба MySQL

      ps aux | grep mysql

      sudo service mysql restart

- прослушивает ли MySQL правильный порт

      sudo netstat -nap | grep mysql

    Должна появиться строка с 0.0.0.0:3306

- попытка подключения к MySQL

      mysql -uroot -proot

- сброс пароля  
  https://dev.mysql.com/doc/refman/5.7/en/resetting-permissions.html

      sudo service mysql stop
      cd /var/run
      sudo mkdir /var/run/mysqld
      sudo chown mysql: /var/run/mysqld

      sudo mysqld_safe --skip-grant-tables --skip-networking &

      mysql -uroot mysql

      UPDATE mysql.user SET authentication_string=PASSWORD('secure'), plugin='mysql_native_password' WHERE User='root' AND Host='%';

      exit;

      sudo mysqladmin -S /var/run/mysqld/mysqld.sock shutdown

      sudo service mysql start

      mysql -uroot -psecure
      exit

- проверить файлы логов

      cd /var/log/mysql
      ls -la

      tail error.log

## 52. Troubleshooting PHP

Решение проблем:

    php --version
    php --info
    php --info | grep -i opcache

PHP info

    <?php  phpinfo();  ?>

Журнал ошибок

`/var/log/php_errors.log`

Наблюдать онлайн логи

    tail -f /var/log/php_errors.log

Затем вызвать вывод ошибок на страницу.

---