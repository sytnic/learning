## 003-Setting up the environment

https://www.jetbrains.com/datagrip/

## 004-PostgreSQL explore

https://www.postgresql.org/about/

В PostgreSQL есть материализованные представления (materialized view).

Материализованные представления (view) сохраняют значения статично. При обновлении таблицы, значения в мат.вью не изменяются, пока не сделать refresh view. В обычных представлениях значения изменяются сразу.  

## 005-PostgreSQL commands

Примеры выполнения запросов в PosgreSQL, которые дают тот же результат в сравнении с обычным SQL.

```sql
-- fetch statement (LIMIT)
select * from customers limit 10 ;
select * from customers fetch first 10 rows only;

-- intersect statement (DISTINCT)
select distinct c.id
from customers c
join orders o on o.customer_id = c.id;

select id
from customers
intersect
select customer_id from orders;

-- full outer join
select *
from customers c
full outer join orders o on o.customer_id = c.id;

```

Проверка ограничений

```sql
-- check constraints
create table christmas_products (
   id text not null,
   price integer not null check (price > 0),
   christmas boolean
);

-- Postgre позволяет указывать 'yes' вместо true. В таблицу будет вставлено true.
-- insert values into christmas_products to see if constraint works
insert into christmas_products
values(
      'abc',23,'yes'
     );

-- check if values insert into christmas products
select * from christmas_products;

-- Отрицательное число вставить не получится, т.к. имеется ограничение (price > 0) при создании таблицы
-- test price constraint again in christmas products
insert into christmas_products
values(
      'xyz', -1,'yes'
     );

-- true вставляется как обычно
-- boolean test
insert into christmas_products
values(
      'abc',23,true
     );

```

Каскад - удаляет все запросы, функции, ссылки, связанные с удаляемой таблицей.  

```sql
drop table christmas_products cascade;
```

## 006-Inheritance and data types

```sql

---inheritance
-- creating desserts table, inherits the products table
create table desserts (
   chocolate boolean 
   -- добавляемый столбец, остальные наследуются
)
inherits (products);

select * from desserts;

---json objects
-- Создание JSON-объекта на основе данных таблицы products
select json_build_object('id', id,'name', name,'category',category)
from products

-- json object into a table
create table product_json (
   product_names json
);

-- insert into the product json table
insert into product_json
select json_build_object('id', id,'name', name,'category',category)
from products

select * from product_json;


```

## 007-Features

Функции в PostgreSQL можно создавать на разных языках программирования: SQL, Perl, Python и т.д.  
Здесь - на SQL.  

```sql
--- functions
CREATE FUNCTION add(integer, integer) RETURNS integer
   AS 'select $1 + $2;'
   LANGUAGE SQL
   IMMUTABLE
   RETURNS NULL ON NULL INPUT;

select add(1,-3)
-- ответ будет в таблице,
-- столбец add
-- одна строка, значение -2

```

---